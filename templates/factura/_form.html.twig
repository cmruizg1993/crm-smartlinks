
{{ form_start(form) }}




<div class="invoice-header">

    <!-- Row start -->
    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Emisi√≥n</label>
                        <div class="col-8">
                            <div id="datepicker-popup" class="input-group date datepicker navbar-date-picker">
                                                    <span class="input-group-addon input-group-prepend border-right">
                                                        <span class="icon-calendar input-group-text calendar-icon"></span>
                                                    </span>
                                {{ form_widget(form.fecha) }}
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Serie</label>
                        <div class="col-8">
                            {{ form_widget(form.puntoEmision) }}
                        </div>

                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">CI/RUC</label>
                        <div class="col-8">
                            <div class="input-group">
                                {{ form_widget(form.cedula) }}
                                <div class="input-group-append">
                                    {{ include('modals/buscarContrato.html.twig') }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Vence</label>
                        <div class="col-8">
                            <div id="datepicker-popup" class="input-group date datepicker navbar-date-picker">
                                                    <span class="input-group-addon input-group-prepend border-right">
                                                        <span class="icon-calendar input-group-text calendar-icon"></span>
                                                    </span>
                                {{ form_widget(form.vence) }}
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Secuencial</label>
                        <div class="col-8">
                            {{ form_widget(form.secuencial) }}
                        </div>

                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Nombre</label>
                        <div class="col-8">
                            {{ form_widget(form.nombre) }}
                        </div>

                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Usuario</label>
                        <div class="col-8">
                            {{ form_widget(form.usuario) }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Comprobante</label>
                        <div class="col-8">
                            {{ form_widget(form.tipoComprobante) }}
                        </div>
                    </div>
                    <div class="form-group row">
                        <label class="col-4 col-form-label">Referencia</label>
                        <div class="col-8">
                            {{ form_widget(form.referencia) }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group row justify-content-end">
                        <label for="" class="col-form-label col-4">
                            <span class="float-right">#Contrato</span>
                        </label>
                        <div class="col-8">
                            {{ form_widget(form.contrato,{ 'attr': {'class':'form-control', 'style':'color: red; font-weight: 700; font-size: 2rem !important; line-height: 3rem; height: 3rem !important', 'onkeydown':  'if(event.keyCode==8 || event.keyCode == 46) return true; return /[0-9]/i.test(event.key)'}}) }}
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="form-group row">
                        <label class="col-2 col-form-label">Observ.</label>
                        <div class="col-10">
                            {{ form_widget(form.observaciones) }}
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <div class="row">
        <div class="col d-flex justify-content-end">
            <button class="btn btn-success btn-sm">{{ button_label|default('Save') }}</button>
            <a class="btn btn-secondary btn-sm" href="{{ path('factura_index') }}">back to list</a>
        </div>
    </div>
    <!-- Row end -->
</div>
<div class="invoice-body">

    <!-- Row start -->
    <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
            <div class="table-responsive">
                {{ form_widget(form.detallesjson) }}
                <table class="table custom-table m-0">
                    <thead>
                    <tr>
                        <th>Cod</th>
                        <th>Detalle</th>
                        <th>Precio</th>
                        <th>Cantidad</th>
                        <th>SubTotal</th>
                    </tr>
                    </thead>
                    <tbody class="detalles" id="tDetalles"
                           data-index="{{ form.detalles|length > 0 ? form.detalles|last.vars.name + 1 : 0 }}"
                           data-prototype="{{ form_widget(form.detalles.vars.prototype)|e('html_attr') }}">
                    {#
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    #}
                    </tbody>
                    <tfooter>
                        <tr>
                            <td>&nbsp;</td>
                            <td class="align-content-end" colspan="3">
                                <p class="d-flex justify-content-end">Subtotal</p>
                                <p class="d-flex justify-content-end">IVA 12%</p>
                                <h4 class="d-flex justify-content-end text-success">TOTAL</h4>
                            </td>
                            <td colspan="1">
                                <p class="d-flex justify-content-end">
                                    $<span id="txtSubtotal">0.00</span>
                                </p>
                                <p class="d-flex justify-content-end">
                                    $<span id="txtIva">0.00</span>
                                </p>
                                <h4 class="d-flex justify-content-end text-success">
                                    <i class="mdi mdi-square-inc-cash"></i>
                                    <strong id="txtTotal">0.00</strong>
                                </h4 >
                            </td>
                        </tr>
                    </tfooter>
                </table>
            </div>
        </div>
    </div>
    <!-- Row end -->
</div>



<script>

    const addFormToCollection = (e) => {
        const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

        const item = document.createElement('tr');
        const aux = document.createElement('div')
        aux.innerHTML = collectionHolder
            .dataset
            .prototype
            .replace(
                /__name__/g,
                collectionHolder.dataset.index
            );
        let name = 'factura_detalles_'+ collectionHolder.dataset.index

        item.setAttribute('id', name);
        let htmlChild = aux.firstChild.innerHTML;

       let newhtml = htmlChild.replaceAll('div', 'td');
       item.innerHTML = newhtml;
        /*
        let childNodes = aux.firstChild.childNodes;
        console.log(childNodes)
        let old = item.childNodes;
        item.replaceChildren(...childNodes, ...old)
        item.innerHTML.replace('div','tr')
        */
        collectionHolder.appendChild(item);

        collectionHolder.dataset.index++;
    };

    document
        .querySelectorAll('.add_item_link')
        .forEach(btn => {
            btn.addEventListener("click", addFormToCollection)
        });
</script>

